# RAG 시스템 평가 가이드

## 개요

이 프로젝트는 FDA 의약품 정보 Q&A RAG 시스템의 성능을 평가하기 위한 도구를 제공합니다.

## 평가 구성 요소

### 1. 테스트 데이터셋 (`test_dataset.json`)

- **총 50개의 테스트 케이스**
- **질문 형식**: 한국어
- **검색 키워드**: 영어로 자동 변환
- **카테고리**:
  - `brand_name`: 브랜드명 검색 (예: Tylenol, Advil)
  - `generic_name`: 성분명 검색 (예: acetaminophen, ibuprofen)
  - `indication`: 증상/효능 검색 (예: headache, pain)

### 2. 평가 스크립트 (`evaluate_rag.py`)

Ragas 라이브러리를 사용한 자동 평가 시스템입니다.

#### 평가 지표

1. **Faithfulness (충실도)**
   - 답변이 검색된 컨텍스트에 근거하는지 측정
   - 환각(hallucination) 감지

2. **Answer Relevancy (답변 관련성)**
   - 답변이 질문과 얼마나 관련 있는지 평가
   - 주제 이탈 여부 확인

3. **Context Precision (컨텍스트 정밀도)**
   - 검색된 컨텍스트의 정확성 평가
   - 노이즈 대비 신호 비율

4. **Context Recall (컨텍스트 재현율)**
   - 필요한 정보를 모두 검색했는지 확인
   - 정보 누락 감지

## 사용 방법

### 1. 의존성 설치

```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정

`.env` 파일에 OpenAI API 키를 설정하세요:

```
OPENAI_API_KEY=your-api-key-here
```

### 3. 평가 실행

```bash
cd DJAeun
python evaluate_rag.py
```

### 4. 결과 확인

- **터미널 출력**: 컬러풀한 한글 진행 상황 및 결과 표시
- **결과 파일**: `evaluation_results.json`에 저장됨

## 출력 예시

```
============================================================
          🔬 FDA 의약품 정보 RAG 시스템 평가
============================================================

✓ 환경 변수 검증 완료
▶ 테스트 데이터셋 로드 중: test_dataset.json
✓ 총 50개의 테스트 케이스 로드 완료

▶ RAG 시스템 답변 생성 중...
답변 생성: 100%|████████████████| 50/50 [02:15<00:00,  2.71s/it]
✓ 50개 답변 생성 완료

▶ Ragas 평가 시작...
평가 지표:
  • Faithfulness (충실도): 답변이 검색된 문서에 근거하는가
  • Answer Relevancy (답변 관련성): 답변이 질문과 관련 있는가
  • Context Precision (컨텍스트 정밀도): 검색이 정확한가
  • Context Recall (컨텍스트 재현율): 필요한 정보를 모두 검색했는가

▶ 평가 진행 중 (시간이 다소 걸릴 수 있습니다)...
✓ 평가 완료!

============================================================
                     📊 평가 결과
============================================================

【 평가 지표별 점수 】

faithfulness         ████████████████████████████████░░░░░░░░ 0.8234
answer_relevancy     ███████████████████████████████████░░░░░ 0.8756
context_precision    ████████████████████████████░░░░░░░░░░░░ 0.7123
context_recall       ██████████████████████████████░░░░░░░░░░ 0.7645

────────────────────────────────────────────────────────────
전체 평균 점수       ███████████████████████████████░░░░░░░░░ 0.7940
────────────────────────────────────────────────────────────

종합 평가: 양호 - 개선의 여지가 있지만 적절하게 작동합니다.

✓ 결과 저장 완료: evaluation_results.json

============================================================
                     ✅ 평가 완료
============================================================
```

## 점수 해석

- **0.8 이상**: 우수 - 시스템이 매우 잘 작동합니다
- **0.6 ~ 0.8**: 양호 - 개선 여지가 있지만 적절히 작동합니다
- **0.6 미만**: 개선 필요 - 시스템 개선이 필요합니다

## 커스터마이징

### 테스트 데이터 추가

`test_dataset.json`에 새로운 테스트 케이스를 추가할 수 있습니다:

```json
{
  "question": "한글 질문",
  "ground_truth": "정답 또는 기대되는 답변",
  "category": "brand_name|generic_name|indication",
  "keyword": "영어 검색 키워드"
}
```

### 평가 지표 변경

`evaluate_rag.py`의 `metrics` 리스트를 수정하여 다른 Ragas 지표를 추가할 수 있습니다.

## 문제 해결

### OpenAI API 오류
- `.env` 파일에 올바른 API 키가 설정되어 있는지 확인
- API 사용량 한도를 확인

### 메모리 부족
- 테스트 케이스 수를 줄이거나
- 배치 크기를 조정

## 참고 자료

- [Ragas 공식 문서](https://docs.ragas.io/)
- [Ragas GitHub](https://github.com/vibrantlabsai/ragas)
